package org.rtext.lang.specs.integration

import org.eclipse.core.resources.IFile
import org.rtext.lang.specs.util.WorkspaceConnectorHelper

import static org.rtext.lang.specs.util.Jobs.*

import static extension org.jnario.lib.JnarioIterableExtensions.*
import static extension org.jnario.lib.Should.*
import static extension org.jnario.lib.StringConversions.*

Feature: Model Reload on File Change

	Scenario: All connected backends are reloaded on .rtext file change
		
		extension WorkspaceConnectorHelper w = new WorkspaceConnectorHelper
		
		IFile rtextFile 
		Given a project "test"
			createProject(args.first)
		And an .rtext file "test/.rtext" for "*.ect, *.ect2"
			rtextFile = createRTextFile(args.first, args.second.toList)
		And a file "test/example.ect" with
		'''
			EPackage StatemachineMM {
			} 
		'''
			createFile(args.first, args.second) 
			connector(args.first)
		And a file "test/example.ect2" with
		'''
			EPackage StatemachineMM {
			} 
		'''
		And a loaded model for "test/example.ect"
			connect(args.first)
		When changing the .rtext file
			rtextFile.append(" ")
			waitForRTextJobs
		Then the connector for "test/example.ect" is "diconnected"
			if(args.second.contains("not")){
				args.first.log should not contain "disconnect"
			}else{
				args.first.log should contain "disconnect"
			}
		But the connector for "test/example.ect2" is "not disconnected"
